# PixelBot
Бот для Стримерского ПиксельБаттла от ВК и DonationAlerts. Что это за событие, рассказывается здесь: https://games.mail.ru/pc/news/2019-12-26/strimery-srazyatsya-v-pixelbattle/

## Описание работы

Демонстрационное видео (на видео показана работа несколько устаревшей версии бота):
https://youtu.be/2Ews4_iNjMo


### Алгоритм запуска бота (последняя версия бота):
* Вычисление размера вьюпорта браузера.
* Получение палитры цветов.
* Чтение из файла информации о картинках.
* Чтение из файла списка используемых аккаунтов.
* Открытие вкладки браузера с контрольным аккаунтом.
* Ожидание появления кнопки старта игры и нажатие на нее.
* Переход в [главный цикл](https://github.com/AlexusYT/PixelBot/edit/main/README.md#%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC-%D0%B3%D0%BB%D0%B0%D0%B2%D0%BD%D0%BE%D0%B3%D0%BE-%D1%86%D0%B8%D0%BA%D0%BB%D0%B0)

### Алгоритм главного цикла:
* Закрытие лишних вкладок.
* Переключение на вкладку с контрольным аккаунтом.
* Проверка целостности артов и запись поврежденных пикселей в массив.
* Если нет повреждений и все арты дорисованы, через 5 секунд задержки, главный цикл начинается сначала.
* Выбор первого поврежденного арта в качестве цели, если есть.
* [Восстановление поврежденных пикселей](https://github.com/AlexusYT/PixelBot/edit/main/README.md#%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC-%D0%B2%D0%BE%D1%81%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE%D0%B2%D1%80%D0%B5%D0%B6%D0%B4%D0%B5%D0%BD%D0%BD%D1%8B%D1%85-%D0%BF%D0%B8%D0%BA%D1%81%D0%B5%D0%BB%D0%B5%D0%B9), если есть.
* [Размещение пикселей](https://github.com/AlexusYT/PixelBot/edit/main/README.md#%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC-%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D1%8F-%D0%BF%D0%B8%D0%BA%D1%81%D0%B5%D0%BB%D0%B5%D0%B9-%D0%BD%D0%BE%D0%B2%D0%BE%D0%B3%D0%BE-%D0%B0%D1%80%D1%82%D0%B0) нового арта.


### Алгоритм восстановления поврежденных пикселей:
* Пока есть поврежденные пискели, каждая итерация цикла выбирает следующий аккаунт из списка.
* Открытие вкладки браузера с выбранным аккаунтом.
* Ожидание появления кнопки старта игры и нажатие на нее.
* Перемещение холста в левый верхний угол (т.н калибровка, так как стартовая точка всегда разная) 
* Перемещение холста к позиции поврежденного арта.
* [Установка пикселя](https://github.com/AlexusYT/PixelBot/edit/main/README.md#%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BF%D0%B8%D0%BA%D1%81%D0%B5%D0%BB%D1%8F) соответствующего цвета.
* Закрытие вкладки с аккаунтом и исключение этого пикселя из массива поврежденных пикселей.

### Алгоритм установки пикселя:
* Ожидание завершения таймаута (если после последней поставнки пикселя с этого аккаунта прошло меньше 2 минут).
* Перемещения курсора на палитру цветов и выбор необходимого цвета кликом.
* Перемещение курсора на необходимую координату, затем клик для выбора. 
* Перемещение курсора на кнопку подтверждения, затем клик.

### Алгоритм размещения пикселей нового арта:
* Пока есть свободные аккаунты, каждая итерация цикла выбирает следующий аккаунт.
* Открытие вкладки браузера с выбранным аккаунтом.
* Ожидание появления кнопки старта игры и нажатие на нее.
* Если через 5 секунд кнопка так и не стала доступна, аккаунт пропускается.
* Перемещение холста в левый верхний угол (т.н калибровка, так как стартовая точка всегда разная) 
* Перемещение холста к позиции нового арта.
* Перемещение курсора к пикселю по случайным координатам в пределах размера арта.
* Проверка цвета выбранного пикселя на соответсвие цвету требуемого.
* Если в течение 10000 попыток не удалось найти незанятное место, то выбирается следующий аккаунт.
* [Установка пикселя](https://github.com/AlexusYT/PixelBot/edit/main/README.md#%D0%B0%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC-%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B8-%D0%BF%D0%B8%D0%BA%D1%81%D0%B5%D0%BB%D1%8F) соответствующего цвета.

## Таймлапс
В интернете было найдено видео, на котором показаны все изменения холста за время события:
https://vk.com/video_ext.php?oid=-96042317&id=456239190&hash=e7e03fff90f94246

Для лучшего обзора я обрезал часть холста и написал некоторое количество комментариев:
https://youtu.be/7z6hAZuMsog

## Итоги
По [итогам](https://vk.com/wall-182864292_3690) события, группа, за которую учавствовал бот, заняла 3 место.
